syntax = "proto3";

package baagent.v1;

option go_package = "github.com/blcvn/kratos-proto/go/ba-agent;baagent";
option java_package = "com.blcvn.kratos.protos.baagent";

import "ba-agent/base.proto";

// =======================
// BA Agent Service
// =======================
service BAAgentService {
  // Task Execution
  rpc ExecuteTask(ExecuteTaskRequest) returns (ExecuteTaskResponse) {
  }
  
  rpc SubmitInput(SubmitInputRequest) returns (stream StreamExecuteTaskResponse) {
  }
  
  rpc StreamExecuteTask(ExecuteTaskRequest) returns (stream StreamExecuteTaskResponse) {
  }
  
  rpc GetTask(GetTaskRequest) returns (GetTaskResponse) {
  }
  
  // Tools
  rpc ListTools(ListToolsRequest) returns (ListToolsResponse) {
  }
  
  // Memory
  rpc GetMemory(GetMemoryRequest) returns (GetMemoryResponse) {
  }
  
  rpc ClearMemory(ClearMemoryRequest) returns (ClearMemoryResponse) {
  }

  // 3-Tier Workflow Orchestration
  rpc GenerateRequirement(GenerateRequirementRequest) returns (GenerateRequirementResponse) {
  }

  rpc GetDocument(GetDocumentRequest) returns (ExecuteTaskResponse) {
  }

  rpc GetTierIndex(GetDocumentRequest) returns (ExecuteTaskResponse) {
  }

  rpc GetTierOutline(GetDocumentRequest) returns (ExecuteTaskResponse) {
  } 

  rpc GetTierFull(GetDocumentRequest) returns (ExecuteTaskResponse) {
  }

  rpc ApproveRequirement(ApproveRequirementRequest) returns (EmptyResponse) {
  }

  rpc ReviewRequirement(ReviewRequirementRequest) returns (ExecuteTaskResponse) {
  }

  rpc SaveEditedDocument(GenerateRequirementRequest) returns (EmptyResponse) {
  }

  rpc RegenerateRequirement(GenerateRequirementRequest) returns (GenerateRequirementResponse) {
  }

  rpc GetLineage(GetDocumentRequest) returns (EmptyResponse) {
  }
}

// =======================
// Domain Enums
// =======================

enum RequirementTier {
  TIER_UNSPECIFIED = 0;
  TIER_PRD = 1;
  TIER_URD_INDEX = 2;
  TIER_URD_OUTLINE = 3;
  TIER_URD_FULL = 4;
}

// =======================
// Request Messages
// =======================

message GenerateRequirementRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string project_id = 3;
  string parent_document_id = 4; // PRD ID or Parent Tier ID
  RequirementTier tier = 5;
  string module_name = 6;
  string content = 7; // For initial PRD upload
}

message GetDocumentRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string document_id = 3;
}

message ApproveRequirementRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string tier_id = 3;
  string parent_id = 4;
  RequirementTier tier = 5;
}

message ReviewRequirementRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string document_id = 3;
  string comment = 4;
  string action_type = 5;
  string affected_sections = 6; // JSON string
}

message ExecuteTaskPayload {
  string user_id = 1;
  string session_id = 2;
  string task_description = 3;
  int32 max_iterations = 4;
  string workflow_mode = 5; // "interactive" (default) or "pipeline" (future)
  repeated ReActStep history = 6;
}

message ExecuteTaskRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  ExecuteTaskPayload payload = 3;
}

message GetTaskRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string task_id = 3;
}

message ListToolsRequest {
  Metadata metadata = 1;
  Signature signature = 2;
}

message GetMemoryRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string session_id = 3;
}

message ClearMemoryRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string session_id = 3;
}

message SubmitInputRequest {
  Metadata metadata = 1;
  Signature signature = 2;
  string task_id = 3;
  string input_data = 4;
}

// =======================
// Response Messages
// =======================

message EmptyResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
}

message GenerateRequirementResponse {
  Metadata metadata = 1;
  Result result = 2;
  string job_id = 3;
  string document_id = 4;
}

message ExecuteTaskResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
  AgentTask task = 4;
}

message StreamExecuteTaskResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
  ReActStep step = 4;
  bool is_final = 5;
}

message GetTaskResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
  AgentTask task = 4;
}

message ListToolsResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
  repeated Tool tools = 4;
}

message GetMemoryResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
  Memory memory = 4;
}

message ClearMemoryResponse {
  Metadata metadata = 1;
  Signature signature = 2;
  Result result = 3;
}
